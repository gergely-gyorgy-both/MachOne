<div
  class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 xl:grid-cols-5 gap-5 p-5"
>
  @for (device of devices; track $index) {
    @switch (device.category) {
      @case (deviceValues.type.LIGHT) {
        <div
          class="device light p-5"
          [class.light-on]="device.status?.[0].value"
          [class.offline]="!device.online"
          (click)="toggleLight(device)"
        >
          <h2 class="font-semibold uppercase mb-4 text-sm">
            {{ device.name }}

            @if (!device.online) {
              <span class="text-red-500">●</span>
            }
          </h2>
        </div>
      }

      @case (deviceValues.type.VALVE) {
        <div
          class="device p-5"
          [class.valve-auto]="
            device.status?.[0].value === deviceValues.valve.mode.AUTO
          "
          [class.valve-on]="
            device.status?.[1].value === deviceValues.valve.state.OPEN
          "
          [class.offline]="!device.online"
        >
          <h2 class="font-semibold uppercase mb-4 text-sm">
            {{ device.name }}

            @if (!device.online) {
              <span class="text-red-500">●</span>
            }
          </h2>

          @if (device.online) {
            <div class="text-sm space-y-1">
              <div class="degree my-5">
                {{ device.status?.[3].value / 10 }}°
              </div>

              @if (device.status?.[0].value !== deviceValues.valve.mode.OFF) {
                <div class="set-degree">
                  <button
                    class="w-8 h-8"
                    [class.invisible]="
                      device.status?.[2].value / 10 <=
                      deviceValues.valve.minTemp
                    "
                    (click)="setTemperature(device, -1)"
                  >
                    -
                  </button>
                  {{ device.status?.[2].value / 10 }}
                  <button
                    class="w-8 h-8"
                    (click)="setTemperature(device, 1)"
                  >
                    +
                  </button>
                </div>
              }
            </div>
          }
        </div>
      }
      @default {
        <div class="device p-6">
          <h2 class="font-semibold uppercase mb-4 text-sm">
            {{ device.name }}

            @if (!device.online) {
              <span class="text-red-500">●</span>
            }
          </h2>

          <div class="text-sm text-red-500 uppercase">Unknown</div>
        </div>
      }
    }
  }
</div>

<div class="text-center text-gray-500">
  @if (!api.hasAuth()) {
    You need to provide credentials like this:
    <br />
    <a
      class="text-center text-gray-500"
      [routerLink]="['/']"
      [queryParams]="{
        appKey: 'APP_KEY',
        secretKey: 'SECRET_KEY',
      }"
    >
      {{ baseUrl }}?appKey=APP_KEY&secretKey=SECRET_KEY
    </a>
  } @else if (api.hasAuth() && errorMessage) {
    <span class="text-red-500">
      Error<br />
      {{ errorMessage }}</span
    >
  } @else if (api.hasAuth() && !devices) {
    Loading...<br />
    (can take some time if free server needs to wake up)
  } @else if (api.hasAuth() && devices?.length === 0) {
    No devices found
  }
</div>
